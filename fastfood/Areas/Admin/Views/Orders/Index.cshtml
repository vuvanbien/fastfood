@model X.PagedList.IPagedList<fastfood.Models.Order>
@using X.PagedList.Mvc.Core;


@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
<h1 style="font-weight: 700; text-align:center; margin-top:25px; margin-bottom: 25px ">ĐƠN HÀNG</h1>
<div class="card card-primary card-tabs">
    <div class="card-header p-0 pt-1">
        <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">Chưa xác nhận</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-one-profile-tab" data-toggle="pill" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">Đang giao</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-one-messages-tab" data-toggle="pill" href="#custom-tabs-one-messages" role="tab" aria-controls="custom-tabs-one-messages" aria-selected="false">Đã giao</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-one-settings-tab" data-toggle="pill" href="#custom-tabs-one-settings" role="tab" aria-controls="custom-tabs-one-settings" aria-selected="false">Hủy</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="custom-tabs-one-tabContent">
            <div class="tab-pane fade active show" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Mã đơn hàng
                            </th>
                            <th>
                                Tên khách hàng
                            </th>
                            <th>
                                Ngày đặt hàng
                            </th>
                            <th>
                                Tổng tiền
                            </th>
                            <th>
                                Trạng thái
                            </th>
                            <th>
                                Chức năng
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(o=>o.Status=="Chờ xác nhận" ))
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.OrderId)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Cus.CusName)
                                </td>
                                <td>
                                    @{
                                        if (item.OrderDate.HasValue)
                                        {
                                            <text>@item.OrderDate.Value.ToShortDateString()</text>
                                        }
                                        else
                                        {
                                            <text>N/A</text>
                                        }
                                    }
                                <td>
                                        @Html.DisplayFor(modelItem => item.TotalMoney) VND
                                </td>
                                <td>
                                        @Html.DisplayFor(modelItem => item.Status)
                                </td>

                                <td>
                                    <a class="btn btn-success btn-tone m-r-5" asp-action="Details" asp-route-id="@item.OrderId">Chi tiết</a>
                                    <a class="btn btn-primary" href="javascript:void(0);" onclick="xacNhanDonHang(@item.OrderId)">Xác nhận</a>
                                    <a class="btn btn-danger btn-tone m-r-5" href="javascript:void(0);" onclick="huy(@item.OrderId)">Hủy</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                    <ul class="pagination">
                        <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                            <a href="@Url.Action("Index", "Orders", new { page = Model.PageNumber - 1 })" aria-controls="example1" data-dt-idx="0" tabindex="0" class="page-link previous" data-page-number="@Model.PageNumber - 1">&laquo;</a>
                        </li>
                        @for (int i = 1; i <= Model.PageCount; i++)
                        {
                            <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                <a href="@Url.Action("Index", "Orders", new { page = i })" aria-controls="example1" data-dt-idx="@i" tabindex="0" class="page-link">@i</a>
                            </li>
                        }
                        <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                            <a href="@Url.Action("Index", "Orders", new { page = Model.PageNumber + 1 })" aria-controls="example1" data-dt-idx="7" tabindex="0" class="page-link next" data-page-number="@Model.PageNumber + 1">&raquo;</a>
                        </li>
                    </ul>
                </div>
                <script>
                    function xacNhanDonHang(orderId) {
                        $.ajax({
                            url: '/Admin/Orders/XacNhanDonHang',
                            type: 'POST',
                            data: { orderId: orderId },
                            success: function (data) {
                                // Giả sử máy chủ trả về thành công hoặc một đối tượng đơn hàng đã được cập nhật
                                if (data.success) {
                                    // Cập nhật trạng thái trong hàng hiện tại
                                    $('#status_' + orderId).text('Đang giao');

                                    // Tải lại trang Index
                                    location.reload();
                                } else {
                                    alert('Không thể cập nhật trạng thái đơn hàng.');
                                }
                            },
                            error: function () {
                                alert('Đã xảy ra lỗi khi xử lý yêu cầu.');
                            }
                        });
                    }
                    function huy(orderId) {
                        $.ajax({
                            url: '/Admin/Orders/Huy',
                            type: 'POST',
                            data: { orderId: orderId },
                            success: function (data) {
                                // Giả sử máy chủ trả về thành công hoặc một đối tượng đơn hàng đã được cập nhật
                                if (data.success) {
                                    // Cập nhật trạng thái trong hàng hiện tại
                                    $('#status_' + orderId).text('Hủy');

                                    // Tải lại trang Index
                                    location.reload();
                                } else {
                                    alert('Không thể cập nhật trạng thái đơn hàng.');
                                }
                            },
                            error: function () {
                                alert('Đã xảy ra lỗi khi xử lý yêu cầu.');
                            }
                        });
                    }
                </script>
            </div>
            <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Mã đơn hàng
                            </th>
                            <th>
                                Tên khách hàng
                            </th>
                            <th>
                                Ngày đặt hàng
                            </th>
                            <th>
                                Tổng tiền
                            </th>
                            <th>
                                Trạng thái
                            </th>
                            <th>
                                Chức năng
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(o => o.Status == "Đang giao"))
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.OrderId)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Cus.CusName)
                                </td>
                                <td>
                                    @{
                                        if (item.OrderDate.HasValue)
                                        {
                                            <text>@item.OrderDate.Value.ToShortDateString()</text>
                                        }
                                        else
                                        {
                                            <text>N/A</text>
                                        }
                                    }
                                <td>
                                        @Html.DisplayFor(modelItem => item.TotalMoney) VND
                                </td>
                                <td>
                                        @Html.DisplayFor(modelItem => item.Status)
                                </td>

                                <td>
                                    <a class="btn btn-success btn-tone m-r-5" asp-action="Details" asp-route-id="@item.OrderId">Chi tiết</a>
                                    <a class="btn btn-primary btn-tone m-r-5" href="javascript:void(0);" onclick="daGiao(@item.OrderId)">Đã giao</a>
                                    <a class="btn btn-danger btn-tone m-r-5" href="javascript:void(0);" onclick="huy(@item.OrderId)">Hủy</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                <script>
                    function daGiao(orderId) {
                        $.ajax({
                            url: '/Admin/Orders/DaGiao',
                            type: 'POST',
                            data: { orderId: orderId },
                            success: function (data) {
                                // Giả sử máy chủ trả về thành công hoặc một đối tượng đơn hàng đã được cập nhật
                                if (data.success) {
                                    // Cập nhật trạng thái trong hàng hiện tại
                                    $('#status_' + orderId).text('Đã giao');

                                    // Tải lại trang Index
                                    location.reload();
                                } else {
                                    alert('Không thể cập nhật trạng thái đơn hàng.');
                                }
                            },
                            error: function () {
                                alert('Đã xảy ra lỗi khi xử lý yêu cầu.');
                            }
                        });
                    }
                    function huy(orderId) {
                        $.ajax({
                            url: '/Admin/Orders/Huy',
                            type: 'POST',
                            data: { orderId: orderId },
                            success: function (data) {
                                // Giả sử máy chủ trả về thành công hoặc một đối tượng đơn hàng đã được cập nhật
                                if (data.success) {
                                    // Cập nhật trạng thái trong hàng hiện tại
                                    $('#status_' + orderId).text('Hủy');

                                    // Tải lại trang Index
                                    location.reload();
                                } else {
                                    alert('Không thể cập nhật trạng thái đơn hàng.');
                                }
                            },
                            error: function () {
                                alert('Đã xảy ra lỗi khi xử lý yêu cầu.');
                            }
                        });
                    }
                </script>
            </div>
            <div class="tab-pane fade" id="custom-tabs-one-messages" role="tabpanel" aria-labelledby="custom-tabs-one-messages-tab">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Mã đơn hàng
                            </th>
                            <th>
                                Tên khách hàng
                            </th>
                            <th>
                                Ngày đặt hàng
                            </th>
                            <th>
                                Tổng tiền
                            </th>
                            <th>
                                Trạng thái
                            </th>
                            <th>
                                Chức năng
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(o => o.Status == "Đã giao"))
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.OrderId)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Cus.CusName)
                                </td>
                                <td>
                                    @{
                                        if (item.OrderDate.HasValue)
                                        {
                                            <text>@item.OrderDate.Value.ToShortDateString()</text>
                                        }
                                        else
                                        {
                                            <text>N/A</text>
                                        }
                                    }
                                <td>
                                        @Html.DisplayFor(modelItem => item.TotalMoney) VND
                                </td>
                                <td>
                                        @Html.DisplayFor(modelItem => item.Status)
                                </td>

                                <td>
                                    <a class="btn btn-success btn-tone m-r-5" asp-action="Details" asp-route-id="@item.OrderId">Chi tiết</a>                          
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="custom-tabs-one-settings" role="tabpanel" aria-labelledby="custom-tabs-one-settings-tab">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                Mã đơn hàng
                            </th>
                            <th>
                                Tên khách hàng
                            </th>
                            <th>
                                Ngày đặt hàng
                            </th>
                            <th>
                                Tổng tiền
                            </th>
                            <th>
                                Trạng thái
                            </th>
                            <th>
                                Chức năng
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(o => o.Status == "Hủy"))
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.OrderId)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Cus.CusName)
                                </td>
                                <td>
                                    @{
                                        if (item.OrderDate.HasValue)
                                        {
                                            <text>@item.OrderDate.Value.ToShortDateString()</text>
                                        }
                                        else
                                        {
                                            <text>N/A</text>
                                        }
                                    }
                                <td>
                                        @Html.DisplayFor(modelItem => item.TotalMoney) VND
                                </td>
                                <td>
                                        @Html.DisplayFor(modelItem => item.Status)
                                </td>

                                <td>
                                    <a class="btn btn-success btn-tone m-r-5" asp-action="Details" asp-route-id="@item.OrderId">Chi tiết</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- /.card -->
</div>

